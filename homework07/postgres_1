'''1. Сколько мужчин и женщин (признак sex) представлено в этом наборе данных?'''

cursor.execute(
    """
    SELECT sex, COUNT(*)
        FROM adult_data
        GROUP BY sex
    """
)
print(tabulate(fetch_all(cursor), "keys", "psql"))


'''2. Каков средний возраст (признак age) женщин?'''

cursor.execute("""
    SELECT AVG(age) FROM adult_data WHERE sex = 'Female'
""")
print(tabulate(fetch_all(cursor), "keys", "psql"))

'''3. Какова доля граждан Германии (признак native-country)?'''

cursor.execute(
    """
    SELECT native-country, ROUND((COUNT(*) / (SELECT COUNT(*) FROM adult_data)::numeric), 6)
        FROM adult_data
        GROUP BY native-country;
    """
)
print(tabulate(fetch_all(cursor), "keys", "psql"))


'''4-5. Каковы средние значения и среднеквадратичные отклонения возраста тех, 
кто получает более 50K в год (признак salary) и тех, кто получает менее 50K в год?'''

cursor.execute("""
    SELECT COUNT(*),
           AVG(age), STDDEV(age)
    FROM adult_data
    GROUP BY salary
""")
print(tabulate(fetch_all(cursor), "keys", "psql"))


'''6. Правда ли, что люди, которые получают больше 50k, имеют как минимум высшее образование? 
(признак education – Bachelors, Prof-school, Assoc-acdm, Assoc-voc, Masters или Doctorate)'''

cursor.execute("""
    SELECT education, salary COUNT(*) FROM adult_data
    GROUP BY education, salary
""")
print(tabulate(fetch_all(cursor), "keys", "psql"))


'''7. Выведите статистику возраста для каждой расы (признак race) и каждого пола. 
Используйте groupby и describe. Найдите таким образом максимальный возраст мужчин расы Amer-Indian-Eskimo.'''

cursor.execute("""
    SELECT COUNT(*),
           AVG(age), STDDE(age), MIN(age), MAX(age)
    FROM adult_data WHERE sex = 'Female'
    GROUP BY race
""")
print(tabulate(fetch_all(cursor), "keys", "psql"))

cursor.execute("""
    SELECT COUNT(*),
           AVG(age), STDDE(age), MIN(age), MAX(age)
    FROM adult_data WHERE sex = 'Male'
    GROUP BY race
""")
print(tabulate(fetch_all(cursor), "keys", "psql"))


'''8. Среди кого больше доля зарабатывающих много (>50K): среди женатых или холостых мужчин (признак marital-status)? 
Женатыми считаем тех, у кого marital-status начинается с Married (Married-civ-spouse, Married-spouse-absent или Married-AF-spouse), остальных считаем холостыми.'''

cursor.execute("""
    SELECT marital-status, salary COUNT(*) FROM adult_data
    GROUP BY marital-status, salary
""")
print(tabulate(fetch_all(cursor), "keys", "psql"))


'''9. Какое максимальное число часов человек работает в неделю (признак hours-per-week)? 
Сколько людей работают такое количество часов и каков среди них процент зарабатывающих много?'''

cursor.execute("SELECT MAX(hours-per-week::int) FROM adult_data")
print(tabulate(fetch_all(cursor), "keys", "psql"))

cursor.execute(
    """
    SELECT salary, COUNT(*)
        FROM adult_data WHERE hours-per-week = 99
        GROUP BY salary
    """
)
print(tabulate(fetch_all(cursor), "keys", "psql"))

cursor.execute("""
    SELECT hours-per-week, salary COUNT(*) FROM adult_data WHERE hours-per-week = 99
    GROUP BY hours-per-week, salary
""")
print(tabulate(fetch_all(cursor), "keys", "psql"))


'''10. Посчитайте среднее время работы (hours-per-week) зарабатывающих мало и много (salary) для каждой страны (native-country).''' 
countries = set(data['native-country'])
for country in countries:
    cursor.execute("""
        SELECT COUNT(*),
               AVG(hours-per-week)
        FROM adult_data WHERE native-country = ''
        GROUP BY native-country, salary
    """)
    print(tabulate(fetch_all(cursor), "keys", "psql"))
